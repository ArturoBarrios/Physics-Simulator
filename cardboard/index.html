<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cardboard Example</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        margin: 0px;
        overflow: hidden;
      }
      #example {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
      #ui {
  position: absolute;
}
    </style>
  </head>
  <body>
    <div id="example">
      <!-- <button  onclick="" style="top:0" id="fire" class="ui">Choose File</button> -->
      <div id="page-wrapper">

		<h1>Text File Reader</h1>
		<div>
			Select a text file:
			<input type="file" id="fileInput" class="ui">
		</div>
		<pre id="fileDisplayArea"><pre>

	</div>
    </div>

  <script src="js/third-party/threejs/three.js"></script>
  <script src="js/third-party/threejs/StereoEffect.js"></script>
  <script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
  <script src="js/third-party/threejs/OrbitControls.js"></script>

  <script>

    var camera, scene, renderer;
    var effect, controls;
    var element, container;

    var clock = new THREE.Clock();



    ///////////////////////////////////
      window.onload = function() {
    		var fileInput = document.getElementById('fileInput');
    		var fileDisplayArea = document.getElementById('fileDisplayArea');

    		fileInput.addEventListener('change', function(e) {
    			var file = fileInput.files[0];
    			var textType = /text.*/;

    			if (file.type.match(textType)) {
            init()
            animate()
    				var reader = new FileReader();
    				reader.onload = function(e) {
              function filter_array(test_array) {
                  var index = -1,
                  arr_length = test_array ? test_array.length : 0,
                  resIndex = -1,
                  result = [];

                  while (++index < arr_length) {
                      var value = test_array[index];

                      if (value) {
                          result[++resIndex] = value;
                      }
                  }

                  return result;
                }

              var lines = reader.result.split(/[\r\n]+/g);
              for(var i = 0; i < lines.length; i++) {
                var res = filter_array(lines[i].split(" "));
                //parameters for creating vector
                var posX = res[0];
                var posY = res[1];
                var posZ = res[2];
                var atomType = res[3];
                var oriX = res[4];
                var oriY = res[5];
                var oriZ = res[6];
                var magnitude = magnitudeScaling(res[7]);
                //console.log(res.length);
                createVector(posX,posY,posZ,atomType, oriX,oriY,oriZ,magnitude);
              }

    				}

    				reader.readAsText(file);
    			} else {
    				fileDisplayArea.innerText = "File not supported!"
    			}
    		});
    }
    /////////////////////////////////////////////////////////////

    function createVector(posX,posY,posZ,atomType,oriX,oriY,oriZ,magnitude){




      var dir = new THREE.Vector3( oriX, oriY, oriZ);
      dir.normalize();
      console.log(parseInt(posY)+30)
      var origin = new THREE.Vector3((parseInt(posX)+22)*200, (parseInt(posY)+22)*200, (parseInt(posZ)+2)*(200/9));
      // console.log(posX*5, (parseInt(posY)+30)*5, posZ*5)
      var length = magnitudeScaling(magnitude);
      var hex = 0xffff00;

      var arrowHelper = new THREE.ArrowHelper( dir, origin, length, hex );
      scene.add( arrowHelper );
    }
    function init() {
      renderer = new THREE.WebGLRenderer();
      element = renderer.domElement;
      container = document.getElementById('example');
      container.appendChild(element);

      effect = new THREE.StereoEffect(renderer);

      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(90, 1, 0.001, 700);





      //normalize the direction vector (convert to vector of length 1)
      // var dir = new THREE.Vector3( 1, 2, 0 );
      // dir.normalize();
      //
      // var origin = new THREE.Vector3( 0, 0, 10 );
      // var length = 10;
      // var hex = 0xffff00;
      //
      // var arrowHelper = new THREE.ArrowHelper( dir, origin, length, hex );
      // scene.add( arrowHelper );
      camera.position.set(-55,300,0);
      scene.add(camera);

      controls = new THREE.OrbitControls(camera, element);
      controls.rotateUp(Math.PI / 4);
      controls.target.set(
        camera.position.x + 0.1,
        camera.position.y,
        camera.position.z
      );
      controls.noZoom = true;
      controls.noPan = true;

      function setOrientationControls(e) {
        if (!e.alpha) {
          return;
        }

        controls = new THREE.DeviceOrientationControls(camera, true);
        controls.connect();
        controls.update();

        element.addEventListener('click', fullscreen, false);

        window.removeEventListener('deviceorientation', setOrientationControls, true);
      }
      window.addEventListener('deviceorientation', setOrientationControls, true);


      var light = new THREE.HemisphereLight(0x777777, 0x000000, 0.6);
      scene.add(light);

      var texture = THREE.ImageUtils.loadTexture(
        'textures/patterns/checker.png'
      );
      texture.wrapS = THREE.RepeatWrapping;
      texture.wrapT = THREE.RepeatWrapping;
      texture.repeat = new THREE.Vector2(50, 50);
      texture.anisotropy = renderer.getMaxAnisotropy();

      var material = new THREE.MeshPhongMaterial({
        color: 0xffffff,
        specular: 0xffffff,
        shininess: 20,
        shading: THREE.FlatShading,
        map: texture
      });

      var geometry = new THREE.PlaneGeometry(1000, 1000);

      var mesh = new THREE.Mesh(geometry, material);
      mesh.rotation.x = -Math.PI / 2;
      scene.add(mesh);

      window.addEventListener('resize', resize, false);
      setTimeout(resize, 1);
    }

    function resize() {
      var width = container.offsetWidth;
      var height = container.offsetHeight;

      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      renderer.setSize(width, height);
      effect.setSize(width, height);
    }

    function update(dt) {
      resize();

      camera.updateProjectionMatrix();

      controls.update(dt);
    }

    function render(dt) {
      effect.render(scene, camera);
    }
    function getRandomInt(max) {
      return Math.floor(Math.random() * Math.floor(max));
    }

    function animate(t) {

      requestAnimationFrame(animate);

      update(clock.getDelta());
      render(clock.getDelta());
    }

    function fullscreen() {
      if (container.requestFullscreen) {
        container.requestFullscreen();
      } else if (container.msRequestFullscreen) {
        container.msRequestFullscreen();
      } else if (container.mozRequestFullScreen) {
        container.mozRequestFullScreen();
      } else if (container.webkitRequestFullscreen) {
        container.webkitRequestFullscreen();
      }
    }
    function magnitudeScaling(input) {
    return ((9/.1)*Math.abs(input))+1;
    }
  </script>
  </body>
</html>
